<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup - {{ campaign.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/setup_phase.css') }}">
</head>
<body>
    <div class="container">
        <div class="phase-header">
            <h1>‚öîÔ∏è {{ campaign.name }}</h1>
            <p>üìç Phase 1: Setup & Character Creation</p>
            
            <div class="progress">
                <div class="progress-bar">
                    {% set progress = (100 * characters|length / campaign.party_size)|round(0, 'floor')|int if campaign.party_size > 0 else 0 %}
                    <div class="progress-fill" >
                        {{ characters|length }} / {{ campaign.party_size }} Characters
                    </div>
                </div>
            </div>
        </div>
        
        <div class="content">
            <!-- Character Creation Form -->
            <div class="panel">
                <h2>üìù Create Character</h2>
                
                <!-- Tabs for different sections -->
                <div class="tabs">
                    <button class="tab active" onclick="showTab('basics')">Basics</button>
                    <button class="tab" onclick="showTab('stats')">Stats</button>
                    <button class="tab" onclick="showTab('background')">Background</button>
                    <button class="tab" onclick="showTab('personality')">Personality</button>
                    <button class="tab" onclick="showTab('details')">Details</button>
                </div>
                
                <form id="character-form">
                    <!-- TAB 1: BASICS -->
                    <div id="tab-basics" class="tab-content active">
                        <label>Character Name *</label>
                        <input type="text" id="char-name" placeholder="Aragorn" required>
                        
                        <label>Race *</label>
                        <select id="char-race" required onchange="updateRacialLanguages()">
                            <option value="">Select Race</option>
                            <option value="Human">Human</option>
                            <option value="Elf">Elf</option>
                            <option value="Dwarf">Dwarf</option>
                            <option value="Halfling">Halfling</option>
                            <option value="Dragonborn">Dragonborn</option>
                            <option value="Gnome">Gnome</option>
                            <option value="Half-Elf">Half-Elf</option>
                            <option value="Half-Orc">Half-Orc</option>
                            <option value="Tiefling">Tiefling</option>
                        </select>
                        
                        <label>Class *</label>
                        <select id="char-class" required onchange="updateClassSkills()">
                            <option value="">Select Class</option>
                            <option value="Barbarian">Barbarian</option>
                            <option value="Bard">Bard</option>
                            <option value="Cleric">Cleric</option>
                            <option value="Druid">Druid</option>
                            <option value="Fighter">Fighter</option>
                            <option value="Monk">Monk</option>
                            <option value="Paladin">Paladin</option>
                            <option value="Ranger">Ranger</option>
                            <option value="Rogue">Rogue</option>
                            <option value="Sorcerer">Sorcerer</option>
                            <option value="Warlock">Warlock</option>
                            <option value="Wizard">Wizard</option>
                        </select>
                        
                        <label>Alignment *</label>
                        <select id="char-alignment" required>
                            <option value="Lawful Good">Lawful Good</option>
                            <option value="Neutral Good">Neutral Good</option>
                            <option value="Chaotic Good">Chaotic Good</option>
                            <option value="Lawful Neutral">Lawful Neutral</option>
                            <option value="True Neutral" selected>True Neutral</option>
                            <option value="Chaotic Neutral">Chaotic Neutral</option>
                            <option value="Lawful Evil">Lawful Evil</option>
                            <option value="Neutral Evil">Neutral Evil</option>
                            <option value="Chaotic Evil">Chaotic Evil</option>
                        </select>
                        <small style="color: #888;">Choose alignment that fits your character concept</small>
                        
                        <label>Level</label>
                        <input type="number" id="char-level" min="1" max="20" value="1">
                    </div>
                    
                    <!-- TAB 2: STATS -->
                    <div id="tab-stats" class="tab-content">
                        <h3>Ability Scores (60 points total)</h3>
                        <div id="points-remaining">
                            Points Remaining: <span id="points-left">0</span>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-wrapper">
                                <label class="stat-label">STR</label>
                                <input type="number" class="stat-input" id="str" min="1" max="20" value="10" onchange="updatePoints()">
                            </div>
                            <div class="stat-wrapper">
                                <label class="stat-label">DEX</label>
                                <input type="number" class="stat-input" id="dex" min="1" max="20" value="10" onchange="updatePoints()">
                            </div>
                            <div class="stat-wrapper">
                                <label class="stat-label">CON</label>
                                <input type="number" class="stat-input" id="con" min="1" max="20" value="10" onchange="updatePoints()">
                            </div>
                            <div class="stat-wrapper">
                                <label class="stat-label">INT</label>
                                <input type="number" class="stat-input" id="int" min="1" max="20" value="10" onchange="updatePoints()">
                            </div>
                            <div class="stat-wrapper">
                                <label class="stat-label">WIS</label>
                                <input type="number" class="stat-input" id="wis" min="1" max="20" value="10" onchange="updatePoints()">
                            </div>
                            <div class="stat-wrapper">
                                <label class="stat-label">CHA</label>
                                <input type="number" class="stat-input" id="cha" min="1" max="20" value="10" onchange="updatePoints()">
                            </div>
                        </div>
                        
                        <h3 style="margin-top: 20px;">Combat Stats</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                            <div>
                                <label>Hit Points</label>
                                <input type="number" id="char-hp" min="1" value="10">
                            </div>
                            <div>
                                <label>Max HP</label>
                                <input type="number" id="char-max-hp" min="1" value="10">
                            </div>
                            <div>
                                <label>Armor Class</label>
                                <input type="number" id="char-ac" min="1" value="10">
                            </div>
                        </div>
                    </div>
                    
                    <!-- TAB 3: BACKGROUND -->
                    <div id="tab-background" class="tab-content">
                        <label>Background *</label>
                        <select id="char-background" required onchange="updateBackgroundInfo()">
                            <option value="">Select Background</option>
                            <option value="Acolyte">Acolyte</option>
                            <option value="Charlatan">Charlatan</option>
                            <option value="Criminal">Criminal</option>
                            <option value="Entertainer">Entertainer</option>
                            <option value="Folk Hero">Folk Hero</option>
                            <option value="Guild Artisan">Guild Artisan</option>
                            <option value="Hermit">Hermit</option>
                            <option value="Noble">Noble</option>
                            <option value="Outlander">Outlander</option>
                            <option value="Sage">Sage</option>
                            <option value="Sailor">Sailor</option>
                            <option value="Soldier">Soldier</option>
                            <option value="Urchin">Urchin</option>
                        </select>
                        
                        <label>Background Feature</label>
                        <textarea id="char-bg-feature" placeholder="Describe your background feature (e.g., 'Shelter of the Faithful' for Acolyte)"></textarea>
                        
                        <h3>Skill Proficiencies (Choose 2 from background)</h3>
                        <div id="skill-warning" class="warning-box" style="display: none;">
                            ‚ö†Ô∏è <span id="skill-warning-text"></span>
                        </div>
                        <div class="multi-select-container" id="skills-list">
                            <!-- Will be populated by JavaScript -->
                        </div>
                        
                        <h3>Languages Known</h3>
                        <div id="racial-languages" style="background: rgba(81, 207, 102, 0.1); padding: 10px; border-radius: 6px; margin: 10px 0;">
                            <small>Racial languages: <span id="racial-lang-list">Select race first</span></small>
                        </div>
                        <label>Additional Languages (from background)</label>
                        <div class="multi-select-container" id="languages-list">
                            <!-- Will be populated by JavaScript -->
                        </div>
                        
                        <h3>Tool Proficiencies</h3>
                        <input type="text" id="char-tools" placeholder="e.g., Thieves' tools, Smith's tools">
                    </div>
                    
                    
                    <!-- TAB 4: PERSONALITY -->
                    <div id="tab-personality" class="tab-content">
                        <p style="color: #888; margin-bottom: 15px;">
                            Define your character's personality using dice rolls or manual selection. These guide roleplaying and can earn Inspiration!
                        </p>
                        
                        <!-- PERSONALITY TRAITS (d8) -->
                        <div class="dice-section">
                            <h3>Personality Traits (d8)</h3>
                            <p style="color: #888; font-size: 0.9em; margin-bottom: 10px;">Choose 2 traits (or roll twice)</p>
                            
                            <button type="button" class="dice-roll-btn" id="roll-traits-btn" onclick="rollD8()">
                                üé≤ Roll d8 for Personality Trait
                            </button>
                            
                            <div class="dice-table" id="personality-traits-list">
                                <!-- Populated by JavaScript -->
                            </div>
                            
                            <div class="selection-display-container">
                                <strong>Selected Traits:</strong>
                                <div id="selected-traits-display" class="selection-display">
                                    <em style="color: #888;">No traits selected yet</em>
                                </div>
                            </div>
                        </div>
                        
                        <!-- IDEAL (d6) -->
                        <div class="dice-section">
                            <h3>Ideal (d6)</h3>
                            <p style="color: #888; font-size: 0.9em; margin-bottom: 10px;">Choose 1 ideal that drives you</p>
                            
                            <button type="button" class="dice-roll-btn" id="roll-ideal-btn" onclick="rollD6Ideal()">
                                üé≤ Roll d6 for Ideal
                            </button>
                            
                            <div class="dice-table" id="ideals-list">
                                <!-- Populated by JavaScript -->
                            </div>
                            
                            <div class="selection-display-container">
                                <strong>Selected Ideal:</strong>
                                <div id="selected-ideal-display" class="selection-display">
                                    <em style="color: #888;">No ideal selected yet</em>
                                </div>
                            </div>
                        </div>
                        
                        <!-- BOND (d6) -->
                        <div class="dice-section">
                            <h3>Bond (d6)</h3>
                            <p style="color: #888; font-size: 0.9em; margin-bottom: 10px;">Choose 1 bond that ties you to people or places</p>
                            
                            <button type="button" class="dice-roll-btn" id="roll-bond-btn" onclick="rollD6Bond()">
                                üé≤ Roll d6 for Bond
                            </button>
                            
                            <div class="dice-table" id="bonds-list">
                                <!-- Populated by JavaScript -->
                            </div>
                            
                            <div class="selection-display-container">
                                <strong>Selected Bond:</strong>
                                <div id="selected-bond-display" class="selection-display">
                                    <em style="color: #888;">No bond selected yet</em>
                                </div>
                            </div>
                        </div>
                        
                        <!-- FLAW (d6) -->
                        <div class="dice-section">
                            <h3>Flaw (d6)</h3>
                            <p style="color: #888; font-size: 0.9em; margin-bottom: 10px;">Choose 1 flaw that makes your character interesting</p>
                            
                            <button type="button" class="dice-roll-btn" id="roll-flaw-btn" onclick="rollD6Flaw()">
                                üé≤ Roll d6 for Flaw
                            </button>
                            
                            <div class="dice-table" id="flaws-list">
                                <!-- Populated by JavaScript -->
                            </div>
                            
                            <div class="selection-display-container">
                                <strong>Selected Flaw:</strong>
                                <div id="selected-flaw-display" class="selection-display">
                                    <em style="color: #888;">No flaw selected yet</em>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- TAB 5: DETAILS -->
                    <div id="tab-details" class="tab-content">
                        <h3>Starting Currency</h3>
                        <div class="currency-grid">
                            <div>
                                <div class="currency-label">PP</div>
                                <input type="number" class="currency-input" id="curr-pp" min="0" value="0">
                            </div>
                            <div>
                                <div class="currency-label">GP</div>
                                <input type="number" class="currency-input" id="curr-gp" min="0" value="0">
                            </div>
                            <div>
                                <div class="currency-label">EP</div>
                                <input type="number" class="currency-input" id="curr-ep" min="0" value="0">
                            </div>
                            <div>
                                <div class="currency-label">SP</div>
                                <input type="number" class="currency-input" id="curr-sp" min="0" value="0">
                            </div>
                            <div>
                                <div class="currency-label">CP</div>
                                <input type="number" class="currency-input" id="curr-cp" min="0" value="0">
                            </div>
                        </div>
                        <small style="color: #888;">Total: <span id="total-gold">0</span> gp</small>
                        
                        <h3 style="margin-top: 20px;">Starting Equipment</h3>
                        <textarea id="char-inventory" placeholder="List starting equipment (comma-separated)"></textarea>
                        
                        <label>Character Notes</label>
                        <textarea id="char-notes" placeholder="Backstory, goals, appearance, etc."></textarea>
                    </div>
                    
                    <button type="submit">‚ú® Create Character</button>
                </form>
            </div>
            
            <!-- Party Members List -->
            <div class="panel">
                <h2>üë• Party Members ({{ characters|length}}/{{ campaign.party_size }})</h2>
                
                <div class="character-list">
                    {% if characters %}
                        {% for char in characters %}
                        <div class="character-card">
                            <div class="character-name">{{ char.name }}</div>
                            <div class="character-info">
                                {{ char.race }} {{ char.char_class }} | {{ char.background }}
                            </div>
                            <div class="char-detail-row">
                                <span>Alignment:</span>
                                <span>{{ char.alignment }}</span>
                            </div>
                            <div class="char-detail-row">
                                <span>HP:</span>
                                <span>{{ char.hp }}/{{ char.max_hp }}</span>
                            </div>
                            <div class="char-detail-row">
                                <span>AC:</span>
                                <span>{{ char.ac }}</span>
                            </div>
                            <div class="char-detail-row">
                                <span>Languages:</span>
                                <span>{{ ', '.join(char.languages_known) if char.languages_known else 'None' }}</span>
                            </div>
                            <div class="char-detail-row">
                                <span>Currency:</span>
                                <span>{{ char.currency.gp }}gp, {{ char.currency.sp }}sp, {{ char.currency.cp }}cp</span>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p style="color: #888; text-align: center; padding: 40px 0;">
                            No characters yet. Create your first character!
                        </p>
                    {% endif %}
                </div>
                
                {% if campaign.setup_complete %}
                <button class="advance-btn" onclick="advancePhase()">
                    ‚ú® Advance to Call to Adventure
                </button>
                {% else %}
                <button disabled>
                    Add {{ campaign.party_size - characters|length }} more character(s)
                </button>
                {% endif %}
            </div>
        </div>
    </div>
    
    <script>
        // Expose campaign name to static JS (safe JSON encoding)
        window.campaignName = {{ campaign.name | tojson | safe }};
    </script>
    <script src="{{ url_for('static', filename='js/setup_phase.js') }}"></script>
</body>
</html>