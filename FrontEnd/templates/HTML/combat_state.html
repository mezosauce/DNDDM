<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combat - {{ encounter_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/combat_state.css') }}">
</head>
<body>
    <div id="combat-container">
        <!-- Top Bar -->
        <div id="combat-header">
            <div class="encounter-info">
                <h1>{{ encounter_name }}</h1>
                <div class="round-indicator">Round <span id="current-round">1</span></div>
            </div>
            <div class="combat-controls">
                <button id="btn-settings" class="icon-btn">‚öôÔ∏è</button>
                <button id="btn-flee" class="icon-btn danger">üèÉ</button>
            </div>
        </div>

    <div class="View-Container">
        <div class="Combat-Left">
        <!-- Main Combat Area -->
        <div id="combat-main">
            <!-- Left Side: Your Party -->
            <div id="party-area" class="combatant-area">
                <h2 class="area-title">Your Party</h2>
                <div id="party-list" class="combatant-list">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Center: Battle Animation Area -->
            <div id="battle-animation-area">
                <canvas id="battle-canvas" width="400" height="300"></canvas>
                <div id="damage-numbers-container"></div>
            </div>

            <!-- Right Side: Enemies -->
            <div id="enemy-area" class="combatant-area">
                <h2 class="area-title">Enemies</h2>
                <div id="enemy-list" class="combatant-list">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <!-- Action Menu Area (Bottom) -->
        <div id="action-area">
            <!-- Turn Indicator -->
            <div id="turn-indicator">
                <div class="turn-arrow">‚ñ∫</div>
                <div class="turn-info">
                    <span class="turn-name" id="current-turn-name">Fighter</span>'s Turn
                </div>
            </div>

            <!-- Action Menu -->
            <div id="action-menu" class="menu-container">
                <!-- Main Menu -->
                <div id="main-menu" class="menu active">
                    <button class="action-btn" data-action="attack">
                        <span class="action-icon">‚öîÔ∏è</span>
                        <span class="action-label">ATTACK</span>
                    </button>
                    <button class="action-btn" data-action="skills">
                        <span class="action-icon">‚ú®</span>
                        <span class="action-label">SKILLS</span>
                    </button>
                </div>

                <!-- Skills Submenu -->
                <div id="skills-menu" class="menu submenu">
                    <div class="menu-header">
                        <button class="back-btn">‚Üê Back</button>
                        <h3>Select Skill</h3>
                    </div>
                    <div id="skills-list" class="skill-list">
                        <!-- Populated dynamically based on character class -->
                    </div>
                </div>

                <!-- Target Selection Menu -->
                <div id="target-menu" class="menu submenu">
                    <div class="menu-header">
                        <button class="back-btn">‚Üê Back</button>
                        <h3>Select Target</h3>
                    </div>
                    <div id="target-list" class="target-list">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
        </div>
</div>
        <!-- Combat Log (Overlay/Bottom) -->
        <div id="combat-log-container">
            <div class="log-header" id="log-toggle">
                <span> Combat Log</span>
            </div>
            <div id="combat-log" class="combat-log">
                <!-- Messages populated by JS -->
            </div>
        </div>
    </div>
    <!-- Victory/Defeat Modal -->
    <div id="combat-end-modal" class="modal hidden">
        <div class="modal-content">
            <h2 id="combat-result-title">Victory!</h2>
            <div id="combat-result-details">
                <!-- Populated on combat end -->
            </div>
            <button id="btn-continue" type= "button" class="btn-primary">Continue</button>
        </div>
    </div>
    
    <!-- Class Feature Managers -->
    <script src="{{ url_for('static', filename='js/class_features/base.js') }}"></script>
    <script src="{{ url_for('static', filename='js/class_features/barbarian.js') }}"></script>
    <script src="{{ url_for('static', filename='js/class_features/bard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/class_features/cleric.js') }}"></script>
    <script src="{{ url_for('static', filename='js/class_features/druid.js') }}"></script>
    
    
    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/combat/CombatAnimations.js') }}"></script>
    <script src="{{ url_for('static', filename='js/combat/CombatLog.js') }}"></script>
    <script src="{{ url_for('static', filename='js/combat/BattlefieldView.js') }}"></script>
    <script src="{{ url_for('static', filename='js/combat/ActionMenu.js') }}"></script>
    <script src="{{ url_for('static', filename='js/combat/CombatViewController.js') }}"></script>
    
    

    <script>
        // Initialize combat when page loads
        document.addEventListener('DOMContentLoaded', () => {
            const campaignName = "{{ campaign_name }}";
            const combatId = "{{ combat_id }}";
            
            window.combatController = new CombatViewController(campaignName, combatId);
            window.combatController.initialize();
        });
    </script>
</body>
</html>