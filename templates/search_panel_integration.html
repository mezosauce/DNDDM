<!-- ============================================================================
   ADD SEARCH PANEL TO active_campaign.html
   
   Add this new panel to the right sidebar section (after the Quick Actions panel)
   ============================================================================ -->

<!-- ADD THIS PANEL AFTER THE "Quick Actions" div -->
<div class="panel">
    <h2>üîç SRD Search</h2>
    <div id="embedded-search">
        <div class="search-input-group" style="display: flex; gap: 10px; margin-bottom: 15px;">
            <input type="text" 
                   id="srd-search-input" 
                   placeholder="Search rules, spells, monsters..."
                   style="flex: 1;"
                   onkeypress="if(event.key==='Enter') searchSRD()">
            <button onclick="searchSRD()" style="width: auto; padding: 8px 16px; margin: 0;">Go</button>
        </div>
        
        <div class="quick-searches" style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 10px;">
            <button class="quick-btn" onclick="quickSearchSRD('fireball')">üî• Fireball</button>
            <button class="quick-btn" onclick="quickSearchSRD('grapple')">ü§º Grapple</button>
            <button class="quick-btn" onclick="quickSearchSRD('conditions')">üé≠ Conditions</button>
            <button class="quick-btn" onclick="quickSearchSRD('cover')">üõ°Ô∏è Cover</button>
        </div>
        
        <div id="srd-results" style="max-height: 300px; overflow-y: auto;"></div>
    </div>
</div>

<!-- ============================================================================
   ADD THESE STYLES TO THE <style> SECTION
   ============================================================================ -->
<style>
    /* Add to existing style section */
    .srd-result {
        background: rgba(0, 0, 0, 0.3);
        padding: 10px;
        border-radius: 6px;
        margin-bottom: 8px;
        cursor: pointer;
        border-left: 3px solid transparent;
        transition: all 0.2s;
    }
    
    .srd-result:hover {
        background: rgba(0, 0, 0, 0.5);
        border-left-color: #4dabf7;
    }
    
    .srd-result-title {
        font-weight: bold;
        color: #51cf66;
        font-size: 0.95em;
        margin-bottom: 4px;
    }
    
    .srd-result-snippet {
        color: #b0b0b0;
        font-size: 0.8em;
        line-height: 1.4;
    }
    
    .srd-result-category {
        display: inline-block;
        padding: 2px 6px;
        background: rgba(77, 171, 247, 0.2);
        border-radius: 3px;
        font-size: 0.7em;
        margin-bottom: 4px;
    }
    
    .srd-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 3000;
        overflow: auto;
    }
    
    .srd-modal-content {
        background: #1a1a1a;
        margin: 50px auto;
        padding: 30px;
        border-radius: 10px;
        max-width: 800px;
        border: 2px solid #4dabf7;
        max-height: 80vh;
        overflow-y: auto;
    }
    
    .srd-modal-close {
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        color: #888;
    }
</style>

<!-- ============================================================================
   ADD THESE SCRIPTS TO THE <script> SECTION AT BOTTOM
   ============================================================================ -->
<script>
    // Add to existing script section
    
    let srdSearchResults = [];
    
    function quickSearchSRD(query) {
        document.getElementById('srd-search-input').value = query;
        searchSRD();
    }
    
    async function searchSRD() {
        const query = document.getElementById('srd-search-input').value.trim();
        if (!query) return;
        
        const resultsDiv = document.getElementById('srd-results');
        resultsDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: #888;"><div class="spinner"></div>Searching...</div>';
        
        try {
            const response = await fetch('/api/search', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    query: query,
                    top_k: 5
                })
            });
            
            const data = await response.json();
            
            if (data.error) {
                resultsDiv.innerHTML = `<div style="color: #ff6b6b; padding: 10px;">${data.error}</div>`;
                return;
            }
            
            srdSearchResults = data.results;
            displaySRDResults(data.results);
            
        } catch (error) {
            resultsDiv.innerHTML = `<div style="color: #ff6b6b; padding: 10px;">Error: ${error.message}</div>`;
        }
    }
    
    function displaySRDResults(results) {
        const resultsDiv = document.getElementById('srd-results');
        
        if (results.length === 0) {
            resultsDiv.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">No results found</div>';
            return;
        }
        
        resultsDiv.innerHTML = results.map((result, index) => `
            <div class="srd-result" onclick="showSRDDetail(${index})">
                <div class="srd-result-title">${escapeHtml(result.title)}</div>
                <div class="srd-result-category">${result.category}</div>
                <div class="srd-result-snippet">${escapeHtml(result.snippet)}</div>
            </div>
        `).join('');
    }
    
    function showSRDDetail(index) {
        const result = srdSearchResults[index];
        
        // Create modal if it doesn't exist
        let modal = document.getElementById('srd-modal');
        if (!modal) {
            modal = document.createElement('div');
            modal.id = 'srd-modal';
            modal.className = 'srd-modal';
            modal.innerHTML = `
                <div class="srd-modal-content">
                    <span class="srd-modal-close" onclick="closeSRDModal()">&times;</span>
                    <h2 id="srd-modal-title"></h2>
                    <div id="srd-modal-category" style="display: inline-block; padding: 4px 10px; background: rgba(77, 171, 247, 0.2); border-radius: 4px; margin-bottom: 15px;"></div>
                    <pre id="srd-modal-content" style="white-space: pre-wrap; line-height: 1.6; color: #d0d0d0;"></pre>
                    <button onclick="askAboutSRD('${escapeHtml(result.title)}')" style="margin-top: 15px;">
                        üí¨ Ask DM About This
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        document.getElementById('srd-modal-title').textContent = result.title;
        document.getElementById('srd-modal-category').textContent = result.category;
        document.getElementById('srd-modal-content').textContent = result.content;
        modal.style.display = 'block';
    }
    
    function closeSRDModal() {
        const modal = document.getElementById('srd-modal');
        if (modal) modal.style.display = 'none';
    }
    
    function askAboutSRD(title) {
        const input = document.getElementById('action-input');
        input.value = `Tell me about ${title}`;
        input.focus();
        closeSRDModal();
    }
    
    // Close modal on outside click
    document.addEventListener('click', function(event) {
        const modal = document.getElementById('srd-modal');
        if (modal && event.target === modal) {
            closeSRDModal();
        }
    });
</script>

<!-- ============================================================================
   ALTERNATIVE: EMBED FULL SEARCH PANEL IN IFRAME (Simpler Integration)
   
   Replace the entire panel div above with this iframe approach:
   ============================================================================ -->

<div class="panel">
    <iframe src="/campaign/{{ context.campaign.name }}/search-panel" 
            style="width: 100%; height: 600px; border: none; border-radius: 8px;"
            id="search-frame">
    </iframe>
</div>